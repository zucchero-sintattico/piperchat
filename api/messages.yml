asyncapi: 2.6.0
info:
  title: Piperchat Message broker
  version: 1.0.0
  description: |
    Piperchat intra microservices messages design

channels:
  user.logged.in:
    description: A user logged in
    publish:
      message:
        "$ref": "#/components/messages/User"

  user.logged.out:
    description: A user logged out
    publish:
      message:
        "$ref": "#/components/messages/User"

  user.created:
    description: A user is registered to the system
    publish:
      message:
        "$ref": "#/components/messages/User"

  user.token.refreshed:
    description: A user refreshed his token
    publish:
      message:
        "$ref": "#/components/messages/User"

  user.friend.request.sent:
    description: A user sent a friend request to another one
    publish:
      message:
        "$ref": "#/components/messages/FriendRequest"

  user.friend.request.accepted:
    description: A user accepted a friend request from another one
    publish:
      message:
        "$ref": "#/components/messages/FriendRequest"

  user.connected:
    description: A user is connected to the chat
    publish:
      message:
        "$ref": "#/components/messages/User"

  user.disconnected:
    description: A user is disconnected from the chat
    publish:
      message:
        "$ref": "#/components/messages/User"

  server.created:
    description: A server is created
    publish:
      message:
        "$ref": "#/components/messages/ServerAdvanced"

  server.updated:
    description: A server has been updated
    publish:
      message:
        "$ref": "#/components/messages/ServerAdvanced"

  server.deleted:
    description: A server has been deleted
    publish:
      message:
        "$ref": "#/components/messages/Server"

  server.user.joined:
    description: A user joined a server
    publish:
      message:
        "$ref": "#/components/messages/ServerUser"

  server.user.left:
    description: A user left a server
    publish:
      message:
        "$ref": "#/components/messages/ServerUser"

  channel.created:
    description: A channel is created
    publish:
      message:
        "$ref": "#/components/messages/ChannelAdvanced"

  channel.updated:
    description: A channel has been updated
    publish:
      message:
        "$ref": "#/components/messages/ChannelAdvanced"

  channel.deleted:
    description: A channel has been deleted
    publish:
      message:
        "$ref": "#/components/messages/Channel"

  message.channel.sent:
    description: A new message has been sent to a channel
    publish:
      message:
        "$ref": "#/components/messages/MessageChannel"

  message.direct.sent:
    description: A new message has been sent to a user
    publish:
      message:
        "$ref": "#/components/messages/MessageDirect"

  session.created:
    description: A new session has been created
    publish:
      message:
        "$ref": "#/components/messages/Session"

  session.terminated:
    description: A session has been terminated
    publish:
      message:
        "$ref": "#/components/messages/Session"

  session.user.joined:
    description: A user joined a session
    publish:
      message:
        "$ref": "#/components/messages/SessionUser"

  session.user.left:
    description: A user left a session
    publish:
      message:
        "$ref": "#/components/messages/SessionUser"

components:
  messages:
    User:
      summary: A user
      contentType: application/json
      payload:
        "$ref": "#/components/schemas/UserSchema"
    Server:
      summary: A server
      contentType: application/json
      payload:
        "$ref": "#/components/schemas/ServerBasicSchema"
    ServerAdvanced:
      summary: A server
      contentType: application/json
      payload:
        "$ref": "#/components/schemas/ServerAdvancedSchema"
    ServerUser:
      summary: A server user
      contentType: application/json
      payload:
        "$ref": "#/components/schemas/ServerUserSchema"
    FriendRequest:
      summary: A friend request
      contentType: application/json
      payload:
        "$ref": "#/components/schemas/FriendRequest"
    Channel:
      summary: A channel
      contentType: application/json
      payload:
        "$ref": "#/components/schemas/ChannelBasicSchema"
    ChannelAdvanced:
      summary: A channel
      contentType: application/json
      payload:
        "$ref": "#/components/schemas/ChannelAdvancedSchema"
    MessageChannel:
      summary: A message
      contentType: application/json
      payload:
        "$ref": "#/components/schemas/MessageChannelSchema"
    MessageDirect:
      summary: A message
      contentType: application/json
      payload:
        "$ref": "#/components/schemas/MessageDirectSchema"
    Session:
      summary: A session
      contentType: application/json
      payload:
        "$ref": "#/components/schemas/SessionSchema"
    SessionUser:
      summary: A session user
      contentType: application/json
      payload:
        "$ref": "#/components/schemas/SessionUserSchema"

  schemas:
    FriendRequest:
      type: object
      properties:
        from:
          type: string
          description: Unique identifier representing a specific user
          example: user1
        to:
          type: string
          description: Unique identifier representing a specific user
          example: user2

    UserSchema:
      type: object
      properties:
        username:
          type: string
          description: Unique identifier representing a specific user
          example: user1

    ServerBasicSchema:
      type: object
      properties:
        serverId:
          type: string
          description: Unique identifier representing a specific server
          example: server1

    ServerAdvancedSchema:
      allOf:
        - $ref: "#/components/schemas/ServerBasicSchema"
        - type: object
          properties:
            name:
              type: string
              description: Name of the server
              example: My server
            description:
              type: string
              description: Description of the server
              example: My server description

    ServerUserSchema:
      allOf:
        - $ref: "#/components/schemas/ServerBasicSchema"
        - type: object
          properties:
            serverId:
              type: string
              description: Unique identifier representing a specific server
              example: server1

    ChannelBasicSchema:
      type: object
      properties:
        channelId:
          type: string
          description: Unique identifier representing a specific channel
          example: channel1

    ChannelAdvancedSchema:
      allOf:
        - $ref: "#/components/schemas/ChannelBasicSchema"
        - type: object
          properties:
            type:
              type: string
              description: Type of the channel
              example: message, multimedia
            name:
              type: string
              description: Name of the channel
              example: general
            description:
              type: string
              description: Description of the channel
              example: General discussion

    MessageSchema:
      type: object
      properties:
        messageId:
          type: string
          description: Unique identifier representing a specific message
          example: message1
        from:
          type: string
          description: Unique identifier representing a specific user
          example: user1

    MessageDirectSchema:
      allOf:
        - "$ref": "#/components/schemas/MessageSchema"
        - type: object
          properties:
            to:
              type: string
              description: Unique identifier representing a specific user
              example: user2

    MessageChannelSchema:
      allOf:
        - "$ref": "#/components/schemas/MessageSchema"
        - type: object
          properties:
            channelId:
              type: string
              description: Unique identifier representing a specific channel
              example: channel1

    SessionSchema:
      type: object
      properties:
        sessionId:
          type: string
          description: Unique identifier representing a specific session
          example: session1

    SessionUserSchema:
      allOf:
        - "$ref": "#/components/schemas/SessionSchema"
        - type: object
          properties:
            userId:
              type: string
              description: Unique identifier representing a specific user
              example: user1
