<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Document</title>
		<style>
			#videos {
				display: flex;
				flex-wrap: wrap;
			}
			#videos video {
				width: 500px;
				height: 600px;
			}
		</style>
	</head>
	<body>
		<h1>Client</h1>
		<video id="video" width="500" height="600" autoplay></video>
		<div id="videos"></div>
		<script type="module">
			import { connect } from "./webrtc.js";
			const token =
				"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6IlJvMHQtc2V0IiwiZW1haWwiOiJwd2RAcHdkLmNvbSIsImlkIjoiNjRiNWFlZjhiODIzODBkMWQzM2FkNzQ1IiwiaWF0IjoxNjg5NjMwOTU0LCJleHAiOjE3MDI1OTA5NTR9.b-pXklIx0_TF6iLTqwcO0uweWCmcINy0xiYLYILaTSc";

			// Take roomId by query param session
			const urlParams = new URLSearchParams(window.location.search);
			const sessionId = urlParams.get("session");

			const videoMap = {};
			connect(
				sessionId,
				token,
				(stream) => {
					const video = document.getElementById("video");
					video.srcObject = stream;
					video.autoplay = true;
					videos.appendChild(video);
					// Added the username over the video
					const usernameDiv = document.createElement("div");
					usernameDiv.innerText = "Me";
					videos.appendChild(usernameDiv);
				},
				(username, stream) => {
					const videos = document.getElementById("videos");
					// Create a new video element and add to videos
					const video = document.createElement("video");
					video.srcObject = stream;
					video.autoplay = true;
					videos.appendChild(video);
					videoMap[username] = video;
					// Added the username over the video
					const usernameDiv = document.createElement("div");
					usernameDiv.innerText = username;
					videos.appendChild(usernameDiv);
				},
				(username) => {
					const video = videoMap[username];
					video.remove();
				}
			);
		</script>
	</body>
</html>
